(function(a){a.fn.pidCrypt=function(j){var r={storage:"localStorage",form:a(this).attr("id"),proxy:a(this).attr("action"),type:a(this).attr("method"),aes:"",reset:false,debug:false,data:{},callback:function(){}};var H={init:function(K){var L=a.extend({},r,K);if(c(L)){L.aes=B();w(L);l(L);a("#"+L.form).live("submit",function(M){M.preventDefault();(L.debug)?a("#"+L.form).append(D(L)):false;p(L);});}return true;},sign:function(K){var L=a.extend({},r,K);if(c(L)){L.aes=B();w(L);l(L);L.data["do"]="sign";a("#"+L.form).live("submit",function(M){M.preventDefault();(L.debug)?a("#"+L.form).append(D(L)):false;p(L);});}return true;},sign_encrypt:function(K){var L=a.extend({},r,K);if(c(L)){L.aes=B();w(L);l(L);L.data["do"]="sign_encrypt";a("#"+L.form).live("submit",function(M){M.preventDefault();(L.debug)?a("#"+L.form).append(D(L)):false;p(L);});}return true;}};var p=function(L){var K=F(L,t(L));K=(s(L.data)>0)?a.extend({},K,L.data):K;(L.debug)?v(L,K):false;a.ajax({data:K,type:L.type,url:L.proxy,context:L.id,beforeSend:function(M){M.setRequestHeader("X-Alt-Referer","jQuery.pidCrypt");},success:function(M){(L.debug)?a("#"+L.form).append("<b>Server response:</b><br/>&nbsp;"+M):false;((L.callback)&&(a.isFunction(L.callback)))?L.callback.call(M):false;},complete:function(M){(L.reset)?n(L):false;}});return false;};var F=function(L,M){var K={};var N=e(o(L));m(L,N);if(s(M)>0){a.each(M,function(P,O){if(typeof O==="object"){K[P]={};a.each(O,function(R,Q){K[P][R]=pidCrypt.RSA.prototype.encrypt(Q);});}else{K[P]=pidCrypt.RSA.prototype.encrypt(O);}});}else{K=0;}return K;};var m=function(M,P){if(P.b64){var L=pidCryptUtil.decodeBase64(P.b64);var O=new pidCrypt();var N=pidCrypt.ASN1.decode(pidCryptUtil.toByteArray(L));var K=N.toHexTree();pidCrypt.RSA.prototype.setPublicKeyFromASN(K);}return O;};var z=function(K){var P="0123456789abcdef".split("");var N=[],M=Math.random,O;N[8]=N[13]=N[18]=N[23]="-";N[14]="4";for(var L=0;L<36;L++){if(!N[L]){O=0|M()*16;N[L]=P[(L==19)?(O&3)|8:O&15];}}return(K!==null)?N.join("").replace(/-/g,"").split("",K).join(""):N.join("");};var B=function(){return new pidCrypt.AES.CBC();};var w=function(K){(q(K.storage,"uuid"))?q(K.storage,"uuid"):g(K.storage,"uuid",z(null));(q(K.storage,"iv"))?q(K.storage,"iv"):g(K.storage,"iv",z(16));};var l=function(K){(q(K.storage,"pub")&&(!K.reset))?q(K.storage,"pub"):k(K);};var o=function(K){return K.aes.decryptText(q(K.storage,"pub"),q(K.storage,"uuid"),{nBits:256,salt:q(K.storage,"iv")});};var k=function(K){a.ajax({data:"k=true&u="+q(K.storage,"uuid")+"&i="+q(K.storage,"iv"),type:"post",url:K.proxy,success:function(L){g(K.storage,"pub",K.aes.encryptText(L,q(K.storage,"uuid"),{nBits:256,salt:q(K.storage,"iv")}));}});return false;};var n=function(K){(q(K.storage,"uuid"))?i(K.storage,"uuid"):false;(q(K.storage,"uuid"))?i(K.storage,"pub"):false;(q(K.storage,"iv"))?i(K.storage,"iv"):false;};var t=function(K){var L={};a.each(a("#"+K.form+' :text, :password, :file, input:hidden, input:checkbox:checked, input:radio:checked, textarea, input[type="email"], input[type="url"], input[type="number"], input[type="range"], input[type="date"], input[type="month"], input[type="week"], input[type="time"], input[type="datetime"], input[type="datetime-local"], input[type="search"], input[type="color"]'),function(N,M){if(y(M.value)){L[M.name]=(parseInt(M.value.length)>80)?G(M.value):M.value;}});return L;};var s=function(K){var L=0;a.each(K,function(N,M){if(K.hasOwnProperty(N)){L++;}});return L;};var G=function(O){var M=O.length/80;var P={};var K=0;var N=80;for(var L=0;L<M;L++){if(L>0){K=K+80;N=N+80;}if(O.slice(K,N).length>0){P[L]=O.slice(K,N);}}return P;};var D=function(K){if(K.debug){a("#"+K.form).append("<b>Processing form contents...</b><br/>");a("#"+K.form).append("&nbsp;<i>UUID:</i> "+q(K.storage,"uuid")+"<br/>");a("#"+K.form).append("&nbsp;<i>IV:</i> "+q(K.storage,"iv")+"<br/>");a("#"+K.form).append("&nbsp;<i>KEY:</i> "+o(K)+"<br/>");}return true;};var v=function(K,L){if(s(L)>0){a("#"+K.form).append("<b>Encrypted data:</b><br/>");a.each(L,function(N,M){if(typeof M==="object"){a("#"+K.form).append("&nbsp;<i>"+N+":</i><br/>");a.each(M,function(O,P){a("#"+K.form).append("&nbsp;<i>"+O+"</i> = "+P+"<br/>");});}else{a("#"+K.form).append("&nbsp;<i>"+N+"</i> = "+M+"<br/>");}});}};var g=function(N,M,L){var K=false;N=(I(N))?N:"cookie";switch(N){case"localStorage":K=d(M,L);break;case"sessionStorage":K=h(M,L);break;case"cookie":K=x(M,L);break;default:K=d(M,L);break;}return K;};var q=function(M,L){var K=false;M=(I(M))?M:"cookie";switch(M){case"localStorage":K=f(L);break;case"sessionStorage":K=C(L);break;case"cookie":K=E(L);break;default:K=f(L);break;}return K;};var i=function(M,L){var K=false;M=(I(M))?M:"cookie";switch(M){case"localStorage":K=b(L);break;case"sessionStorage":K=u(L);break;case"cookie":K=J(L);break;default:K=b(L);break;}return K;};var d=function(L,K){return(localStorage.setItem(L,K))?false:true;};var h=function(L,K){return(sessionStorage.setItem(L,K))?false:true;};var x=function(L,K){if(typeof a.cookie==="function"){return(a.cookie(L,K,{expires:7}))?true:false;}else{return false;}};var f=function(K){return(localStorage.getItem(K))?localStorage.getItem(K):false;};var C=function(K){return(sessionStorage.getItem(K))?sessionStorage.getItem(K):false;};var E=function(K){if(typeof a.cookie==="function"){return(a.cookie(K))?a.cookie(K):false;}else{return false;}};var b=function(K){return(localStorage.removeItem(K))?localStorage.removeItem(K):false;};var u=function(K){return(sessionStorage.removeItem(K))?sessionStorage.removeItem(K):false;};var J=function(K){if(typeof a.cookie==="function"){return(a.cookie(K,"",{expires:-7}))?true:false;}else{return false;}};var y=function(K){return((K===false)||(K.length===0)||(!K)||(K===null)||(K==="")||(typeof K==="undefined"))?false:true;};var I=function(K){try{return((K in window)&&(window[K]))?true:false;}catch(L){return false;}};var e=function(P){var U=P.split("\n");var K=false;var L=false;var M=false;var R="";var N={};N.info="";N.salt="";N.iv;N.b64="";N.aes=false;N.mode="";N.bits=0;for(var Q=0;Q<U.length;Q++){R=U[Q].substr(0,9);if(Q==1&&R!="Proc-Type"&&R.indexOf("M")==0){L=true;}switch(R){case"-----BEGI":K=true;break;case"Proc-Type":if(K){N.info=U[Q];}break;case"DEK-Info:":if(K){var O=U[Q].split(",");var T=O[0].split(": ");var S=T[1].split("-");N.aes=(S[0]=="AES")?true:false;N.mode=S[2];N.bits=parseInt(S[1]);N.salt=O[1].substr(0,16);N.iv=O[1];}break;case"":if(K){L=true;}break;case"-----END ":if(K){L=false;K=false;}break;default:if(K&&L){N.b64+=pidCryptUtil.stripLineFeeds(U[Q]);}}}return N;};var c=function(L){var K=true;if(!a.isFunction(pidCrypt.RSA.prototype.encrypt)){console.log("pidCrypt RSA libraries are missing.Please include the pidCrypt RSA libs...");console.log("Download them from https://www.pidder.com/pidcrypt/");console.log("See README document for necessary includes");K=false;}if(!a.isFunction(pidCrypt.AES.CBC)){console.log("pidCrypt AES-CBC libraries are missing.Please include the pidCrypt AES-CBC libs...");console.log("Download them from https://www.pidder.com/pidcrypt/");console.log("See README document for necessary includes");K=false;}if(L.storage==="cookie"){if(!a.isFunction(a.cookie)){console.log("Cookie use specified but required libraries not available.Please include the jQuery cookie plugin...");console.log("Download it from https://github.com/carhartl/jquery-cookie");K=false;}}return K;};var A=function(K){a.each(K,function(L,M){if(typeof M==="object"){A(M);}else{console.log(L+" => "+M);}});};if(H[j]){return H[j].apply(this,Array.prototype.slice.call(arguments,1));}else{if((typeof j==="object")||(!j)){return H.init.apply(this,arguments);}else{console.log("Method "+j+" does not exist");}}};})(jQuery);
